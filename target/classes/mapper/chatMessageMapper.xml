<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blog.dao.ChatMessageMapper">
    <insert id="insertChatMessage" parameterType="ChatMessage" keyProperty="id">
        insert into chatmessage (send_accountId,to_accountId,user1_user2,message,create_time,status)
        values (
                #{sendAccountId},#{toAccountId},#{user1User2},#{message},#{createTime},#{status}
               )

    </insert>
    <update id="updataChatMessageStatus">
        update chatmessage set status = 1 where user1_user2 = #{user1_user2}
    </update>
    <select id="queryEveryChatLatestWord" resultType="com.blog.entity.ChatMessage">
        select * from chatmessage where id in(
            select max(id) from chatmessage
            where status!=2
            and(send_accountId= #{accountId} or to_accountId = #{accountId})
            group by user1_user2) order by create_time desc
    </select>
    <select id="queryChatMessageList" resultType="com.blog.entity.ChatMessage">
        select * from chatmessage where
        status!=2 and user1_user2 = #{user1_user2} order by create_time asc;
    </select>
    <select id="queryChatUnreadCount" resultType="com.blog.entity.Bo.MessageCountBo">
        select count(user1_user2) as count1,user1_user2 from chatmessage
        where status = 0 and to_accountId = #{accountId} group by user1_user2
    </select>
</mapper>